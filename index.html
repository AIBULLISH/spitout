<script>
  const { Connection, PublicKey } = solanaWeb3;

  const treasuryWallet = new PublicKey("7psAd7T6gCyp9rzKS8xMYa6yBQjLNEi5nJB8qPqtXxQb");
  const SPITOUT_TOKEN_MINT = ""; 

  let provider = null;
  let publicKey = null;

  const connection = new Connection("https://api.mainnet-beta.solana.com");

  const walletButton = document.getElementById("wallet-button");
  const input = document.getElementById("input");
  const sendButton = document.getElementById("send-button");
  const messagesDiv = document.getElementById("messages");
  const statusDiv = document.getElementById("status");

  // ðŸ”¥ Liste mÃ¶glicher Wallets (automatische Erkennung)
  const WALLET_PROVIDERS = [
    { name: "Phantom", check: () => window.solana?.isPhantom, get: () => window.solana },
    { name: "Solflare", check: () => window.solflare, get: () => window.solflare },
    { name: "Backpack", check: () => window.backpack, get: () => window.backpack },
    { name: "OKX", check: () => window.okxwallet?.solana, get: () => window.okxwallet.solana },
    { name: "TokenPocket", check: () => window.tokenpocket?.solana, get: () => window.tokenpocket.solana }
  ];

  async function connectWallet() {
    for (const wallet of WALLET_PROVIDERS) {
      if (wallet.check()) {
        provider = wallet.get();
        try {
          await provider.connect();
          publicKey = provider.publicKey;
          
          walletButton.textContent =
            wallet.name + ": " +
            publicKey.toString().slice(0, 4) + "..." + publicKey.toString().slice(-4);

          input.disabled = false;
          sendButton.disabled = false;

          statusDiv.textContent = "Wallet verbunden â€“ du kannst jetzt chatten.";
          return;
        } catch (err) {
          console.error(wallet.name + " Fehler:", err);
        }
      }
    }

    alert("Keine kompatible Solana Wallet gefunden!");
  }

  async function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;

    input.value = "";
    appendMessage(publicKey.toString(), msg);

    statusDiv.textContent = "Sent 1 USD in SPITOUT (Demo-Mode).";
  }

  function appendMessage(wallet, text) {
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `<div class="wallet">${wallet.slice(0,4)}...${wallet.slice(-4)}</div>${text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  walletButton.addEventListener("click", connectWallet);
  sendButton.addEventListener("click", sendMessage);
</script>
