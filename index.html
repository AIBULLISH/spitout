<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$SPITOUT Chat</title>
  <link rel="icon" type="image/png" href="logo.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d0d0d;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    h1 {
      color: #ff3d3d;
      margin-bottom: 10px;
    }
    #status {
      margin-bottom: 15px;
    }
    #chatbox {
      width: 100%;
      max-width: 500px;
      background: #1a1a1a;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 15px rgba(255,60,60,0.4);
    }
    #comments {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .comment {
      background: #222;
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .comment img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }
    #commentInput {
      width: 75%;
      padding: 8px;
      border-radius: 6px;
      border: none;
      outline: none;
      background: #333;
      color: #eee;
    }
    #sendBtn, #connectBtn {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #ff3d3d;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }
    #sendBtn:disabled {
      background: #444;
      cursor: not-allowed;
    }
    #sendBtn:hover:not(:disabled),
    #connectBtn:hover {
      background: #ff5c5c;
    }
  </style>
</head>
<body>
  <img src="logo.png" alt="Logo" style="width:120px;margin-bottom:10px;">
  <h1>$SPITOUT Chat</h1>
  <p id="status">Connect your wallet to start venting.</p>
  <button id="connectBtn">Connect Wallet</button>

  <div id="chatbox">
    <div id="comments"></div>
    <div style="display:flex;gap:6px;">
      <input id="commentInput" placeholder="Spit it out..." disabled />
      <button id="sendBtn" disabled>Send</button>
    </div>
  </div>

  <!-- Solana wallet adapter -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-wallets@latest/lib/index.iife.js"></script>

  <script>
    const { Connection, PublicKey, Transaction } = solanaWeb3;
    const connection = new Connection("https://api.mainnet-beta.solana.com");

    const TREASURY_WALLET = new PublicKey("7psAd7T6gCyp9rzKS8xMYa6yBQjLNEi5nJB8qPqtXxQb");
    const SPITOUT_MINT = ""; // später ersetzen
    const POST_COST_USD = 1;
    const decimals = 9;

    let userPubkey = null;
    let provider = null;

    async function connectWallet() {
      if (window.phantom?.solana?.isPhantom) {
        provider = window.phantom.solana;
      } else if (window.solflare?.isSolflare) {
        provider = window.solflare;
      } else if (window.backpack?.solana) {
        provider = window.backpack.solana;
      } else {
        alert("No supported Solana wallet found! Install Phantom, Solflare, or Backpack.");
        return;
      }

      try {
        const resp = await provider.connect();
        userPubkey = resp.publicKey || provider.publicKey;
        document.getElementById("status").innerText =
          "Wallet connected: " + userPubkey.toBase58();
        document.getElementById("commentInput").disabled = false;
        document.getElementById("sendBtn").disabled = false;
      } catch (err) {
        console.error(err);
      }
    }

    function getRandomAvatar() {
      const memes = [
        "https://i.imgur.com/Pepe1.png",
        "https://i.imgur.com/Pepe2.png",
        "https://i.imgur.com/Pepe3.png",
        "https://i.imgur.com/Pepe4.png"
      ];
      return memes[Math.floor(Math.random() * memes.length)];
    }

    let comments = [];
    function renderComments() {
      const div = document.getElementById("comments");
      div.innerHTML = "";
      comments.slice().reverse().forEach(c => {
        const el = document.createElement("div");
        el.className = "comment";
        el.innerHTML = `<img src="${c.avatar}" /> ${c.text}`;
        div.appendChild(el);
      });
    }

    async function postComment(text) {
      comments.push({ id: Date.now(), avatar: getRandomAvatar(), text });
      renderComments();

      // hier später SPL Token Transfer einbauen
      console.log(`Would send ${POST_COST_USD} USD in SPITOUT to treasury.`);
    }

    document.getElementById("connectBtn").addEventListener("click", connectWallet);
    document.getElementById("sendBtn").addEventListener("click", () => {
      const text = document.getElementById("commentInput").value.trim();
      if (text) {
        postComment(text);
        document.getElementById("commentInput").value = "";
      }
    });
    document.g
