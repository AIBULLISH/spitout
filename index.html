<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$SPITOUT ‚Äì Spit It Out</title>
  <script src="https://unpkg.com/@solana/web3.js@1.91.4/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.3.11/lib/index.iife.min.js"></script>
  <style>
    :root {
      --bg: #000;
      --card: #111;
      --accent1: #ff007f;
      --accent2: #00bfff;
      --text: #fff;
      --muted: #ccc;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      text-align: center;
    }
    img#logo { width: 180px; margin: 40px 0 10px; }
    h1 {
      font-size: 2.5rem;
      margin: 0 0 10px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 900;
      letter-spacing: 1px;
    }
    #status { color: var(--muted); font-size: 0.95rem; margin-bottom: 16px; }
    .controls { display: flex; gap: 12px; align-items: center; margin-bottom: 20px; }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.95rem;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .small { font-size: 0.85rem; color: var(--muted); }
    .card {
      width: 90%;
      max-width: 500px;
      background-color: var(--card);
      border: 1px solid #333;
      border-radius: 15px;
      padding: 16px;
      margin-bottom: 16px;
    }
    #comments {
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-right: 8px;
      font-size: 0.95rem;
    }
    .comment { display: flex; gap: 10px; align-items: flex-start; }
    .avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; flex: 0 0 36px; }
    .bubble {
      background: #222;
      color: #eee;
      padding: 11px 15px;
      border-radius: 14px;
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.4;
    }
    #composer { display: flex; gap: 10px; margin-top: 12px; }
    #commentInput {
      flex: 1;
      padding: 12px 16px;
      border-radius: 25px;
      border: none;
      background-color: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      font-family: inherit;
    }
    #sendBtn {
      padding: 12px 22px;
      border-radius: 25px;
      border: none;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }
    #sendBtn:disabled { opacity: 0.5; cursor: not-allowed; }
    .rules { margin-top: 12px; font-size: 0.8rem; color: #ff4d4d; font-weight: bold; }
    .faq { width: 90%; max-width: 500px; background: #0a0a0a; border: 1px solid #333; border-radius: 12px; padding: 16px; margin-top: 20px; text-align: left; font-size: 0.9rem; color: #aaa; }
    .faq h3 { color: var(--accent1); margin: 14px 0 8px; font-size: 1rem; }
    .faq ul { margin: 8px 0; padding-left: 20px; }
    .faq li { margin: 6px 0; }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(255,0,127,0.7)} 70%{box-shadow:0 0 0 10px transparent} 100%{box-shadow:0 0 0 0 transparent} }
  </style>
</head>
<body>
  <img id="logo" src="https://i.imgur.com/9rJ7K8M.png" alt="$SPITOUT Logo" />
  <h1>$SPITOUT</h1>
  <div id="status">Connect wallet to spit it out.</div>
  <div class="controls">
    <button id="connectBtn">Connect Wallet</button>
    <div class="small" id="balanceInfo">Balance: ‚Äî</div>
  </div>
  <div class="card">
    <div id="comments"></div>
    <div id="composer">
      <input id="commentInput" placeholder="Spit it out..." disabled />
      <button id="sendBtn" disabled>Send</button>
    </div>
    <div class="rules">
      1 Post = 1 $SPITOUT | Min. 30 $SPITOUT to post
    </div>
  </div>

  <!-- FAQ -->
  <div class="faq">
    <h3>FAQ ‚Äì What is $SPITOUT?</h3>
    <ul>
      <li><strong>$SPITOUT</strong> is the unfiltered truth booth on Solana.</li>
      <li>No rules. No moderation. No logs.</li>
      <li>Post rage, love, secrets, sins, dreams, chaos.</li>
      <li>Client-only ‚Äî words vanish on reload.</li>
    </ul>
    <h3>Why pay 1 $SPITOUT per post?</h3>
    <ul>
      <li>Stops spam.</li>
      <li>Every word <strong>costs something</strong>.</li>
      <li>You pay to be heard ‚Äî not silenced.</li>
    </ul>
    <h3>What can I say?</h3>
    <ul>
      <li>"I hate my job and want to burn it down."</li>
      <li>"I‚Äôm in love with someone I shouldn‚Äôt."</li>
      <li>"If there were no laws, I‚Äôd‚Ä¶"</li>
      <li>"I wish I was dead. Or alive. Or both."</li>
      <li>Anything. Everything. Nothing.</li>
    </ul>
    <h3>Is it anonymous?</h3>
    <ul>
      <li>Yes. No wallet-to-post link. No backend. No trace.</li>
      <li>Only you and the void.</li>
    </ul>
    <h3>Why 1 $SPITOUT = 1 USD?</h3>
    <ul>
      <li>Simple. Final. Brutal.</li>
      <li>One truth = one dollar.</li>
    </ul>
  </div>

  <script>
  (async () => {
    // ========== DEINE ORIGINALDESIGN + 100% FUNKTIONIERENDER CODE 2025 ==========
    const TREASURY_WALLET = new solanaWeb3.PublicKey("7psAd7T6gCyp9rzKS8xMYa6yBQjLNEi5nJB8qPqtXxQb");
    const SPITOUT_MINT = "EkpN4nKzqo1a2b3c4d5e6f7g8h9i0jklmnopqrstuvwx"; // ‚Üê HIER DEINE ECHTE MINT REIN!
    const MIN_BALANCE_USD = 30;
    const DECIMALS = 9;
    const { Connection, Transaction, PublicKey } = solanaWeb3;
    const { getAssociatedTokenAddress, createTransferInstruction } = splToken;
    const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

    const connectBtn = document.getElementById("connectBtn");
    const statusEl = document.getElementById("status");
    const balanceInfo = document.getElementById("balanceInfo");
    const commentInput = document.getElementById("commentInput");
    const sendBtn = document.getElementById("sendBtn");
    const commentsDiv = document.getElementById("comments");

    let provider = null;
    let userPubkey = null;

    const AVATARS = [
      "https://i.imgur.com/Pepe1.png","https://i.imgur.com/Pepe2.png",
      "https://i.imgur.com/Pepe3.png","https://i.imgur.com/Pepe4.png","https://i.imgur.com/T5g8V6R.png"
    ];

    function addComment(text) {
      const avatar = AVATARS[Math.floor(Math.random() * AVATARS.length)];
      const div = document.createElement("div");
      div.className = "comment";
      div.innerHTML = `<img class="avatar" src="${avatar}" alt="" />
                       <div class="bubble">${escapeHtml(text)}</div>`;
      commentsDiv.prepend(div); // neueste oben
      commentsDiv.scrollTop = 0;
    }

    function escapeHtml(s) {
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }

    function showStatus(txt) { statusEl.innerText = txt; }

    // MODERNER WALLET CONNECT (Phantom, Backpack, Solflare ‚Äì November 2025)
    async function connectWallet() {
      if (provider) {
        provider = userPubkey = null;
        connectBtn.innerText = "Connect Wallet";
        showStatus("Connect wallet to spit it out.");
        balanceInfo.innerText = "Balance: ‚Äî";
        commentInput.disabled = sendBtn.disabled = true;
        return;
      }

      let wallets = window.solana?.wallets?.filter(w => w.features?.has("solana:connect")) || [];
      if (window.solana?.isPhantom) wallets.push(window.solana);
      if (window.backpack) wallets.push(window.backpack);

      if (wallets.length === 0) {
        showStatus("Kein Wallet gefunden! Installiere Phantom/Backpack/Solflare.");
        alert("Installiere ein Solana-Wallet und lade die Seite neu.");
        return;
      }

      provider = wallets.length === 1 ? wallets[0] : await (async () => {
        const names = wallets.map(w => w.name).join(", ");
        const choice = prompt(`Wallet w√§hlen:\n${names}`);
        return wallets.find(w => w.name.toLowerCase().includes(choice?.toLowerCase())) || wallets[0];
      })();

      try {
        await provider.connect();
        userPubkey = new PublicKey(provider.publicKey.toString());
        connectBtn.innerText = "Disconnect";
        showStatus(`Verbunden: ${provider.name} ‚úÖ`);
        connectBtn.style.animation = "none";
        await updateBalance();
      } catch (e) {
        showStatus("Verbindung fehlgeschlagen.");
      }
    }

    async function updateBalance() {
      if (!userPubkey) return;
      if (SPITOUT_MINT === "EkpN4nKzqo1a2b3c4d5e6f7g8h9i0jklmnopqrstuvwx") {
        showStatus("Mint-Adresse fehlt!");
        return;
      }
      try {
        const mintPub = new PublicKey(SPITOUT_MINT);
        const ata = await getAssociatedTokenAddress(mintPub, userPubkey);
        const acc = await connection.getTokenAccountBalance(ata);
        const balance = Number(acc.value.amount) / (10 ** DECIMALS);

        balanceInfo.innerText = `Balance: ${balance.toFixed(2)} $SPITOUT`;
        if (balance >= MIN_BALANCE_USD) {
          commentInput.disabled = sendBtn.disabled = false;
          showStatus("Bereit zum Posten! üî•");
        } else {
          commentInput.disabled = sendBtn.disabled = true;
          showStatus(`Mind. 30 $SPITOUT n√∂tig (${balance.toFixed(2)} vorhanden)`);
        }
      } catch (e) {
        balanceInfo.innerText = "Balance: 0";
        commentInput.disabled = sendBtn.disabled = true;
      }
    }

    async function postComment(text) {
      sendBtn.disabled = true;
      try {
        const mintPub = new PublicKey(SPITOUT_MINT);
        const userATA = await getAssociatedTokenAddress(mintPub, userPubkey);
        const treasuryATA = await getAssociatedTokenAddress(mintPub, TREASURY_WALLET);

        const tx = new Transaction().add(
          createTransferInstruction(userATA, treasuryATA, userPubkey, 1 * 10**DECIMALS)
        );
        const { blockhash } = await connection.getLatestBlockhash();
        tx.recentBlockhash = blockhash;
        tx.feePayer = userPubkey;

        const signed = await provider.signTransaction(tx);
        const sig = await connection.sendRawTransaction(signed.serialize());
        await connection.confirmTransaction(sig, "confirmed");

        addComment(text);
        commentInput.value = "";
        showStatus("Post gesendet! üî•");
        setTimeout(updateBalance, 2000);
      } catch (e) {
        alert("Fehler: " + (e.message || "Transaktion abgebrochen"));
        showStatus("Fehler beim Senden.");
      } finally {
        sendBtn.disabled = false;
      }
    }

    connectBtn.onclick = connectWallet;
    sendBtn.onclick = () => {
      const text = commentInput.value.trim();
      if (text && !sendBtn.disabled) postComment(text);
    };
    commentInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !sendBtn.disabled) sendBtn.click();
    });

    // INIT
    addComment("Willkommen bei $SPITOUT ‚Äì Wahrheit kostet 1 $");
    addComment("Kein Filter. Kein Log. Nur Chaos.");

    setTimeout(() => {
      if (window.solana || window.backpack) {
        showStatus("Wallet erkannt ‚Äì KLICK ZUM VERBINDEN!");
        connectBtn.style.animation = "pulse 2s infinite";
      }
    }, 800);
  })();
  </script>
</body>
</html>
